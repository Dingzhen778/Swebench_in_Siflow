```python
### django/db/models/sql/query.py
<<<<<<< SEARCH
        if isinstance(filter_expr, dict):
            raise FieldError("Cannot parse keyword query as dict")
        arg, value = filter_expr
        if not arg:
            raise FieldError("Cannot parse keyword query %r" % arg)
        lookups, parts, reffed_expression = self.solve_lookup_type(arg)
=======
        if isinstance(filter_expr, dict):
            raise FieldError("Cannot parse keyword query as dict")
        arg, value = filter_expr
        if not arg:
            raise FieldError("Cannot parse keyword query %r" % arg)
        lookups, parts, reffed_expression = self.solve_lookup_type(arg)

        # Check if the filter is on an annotated FilteredRelation
        if reffed_expression and isinstance(reffed_expression, FilteredRelation):
            # If the filter is on an annotated FilteredRelation, we need to handle it differently
            if current_negated:
                # For exclude, we need to invert the condition
                condition = self.build_lookup(lookups, reffed_expression, value)
                clause.add(condition, AND)
                return clause, []
            else:
                # For filter, we can proceed as usual
                pass
        else:
            # Proceed with the normal filter building process
            lookups, parts, reffed_expression = self.solve_lookup_type(arg)
>>>>>>> REPLACE
```