```python
### django/db/migrations/recorder.py
<<<<<<< SEARCH
    def ensure_schema(self):
        """Ensure the table exists and has the correct schema."""
        # If the table's there, that's fine - we've never changed its schema
        # in the codebase.
        if self.has_table():
            return
        # Make the table
        try:
            with self.connection.schema_editor() as editor:
                editor.create_model(self.Migration)
        except DatabaseError as exc:
            raise MigrationSchemaMissing("Unable to create the django_migrations table (%s)" % exc)
=======
    def ensure_schema(self):
        """Ensure the table exists and has the correct schema."""
        # Check if the database allows migrations
        if not self.connection.settings_dict.get('ALLOW_MIGRATE', True):
            return
        # If the table's there, that's fine - we've never changed its schema
        # in the codebase.
        if self.has_table():
            return
        # Make the table
        try:
            with self.connection.schema_editor() as editor:
                editor.create_model(self.Migration)
        except DatabaseError as exc:
            raise MigrationSchemaMissing("Unable to create the django_migrations table (%s)" % exc)
>>>>>>> REPLACE
```

This *SEARCH/REPLACE* edit adds a check to ensure that the `ensure_schema` method only attempts to create the `django_migrations` table if the database allows migrations. This is controlled by a new setting `ALLOW_MIGRATE` in the database settings, which defaults to `True` to maintain backward compatibility. If `ALLOW_MIGRATE` is set to `False`, the method will return early without attempting to create the table.